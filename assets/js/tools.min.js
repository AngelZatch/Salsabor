function notifCoursParticipants(e){$.post("functions/watch_participations.php").done(function(t){0==t?$("#badge-participants").hide():(t>$("#badge-participations").html()&&0!=e&&$.notify("Nouvelles participations non associées.",{globalPosition:"bottom right",className:"info"}),$("#badge-participations").show(),$("#badge-participations").html(t),$(".irregular-participations-title>span").text(t))})}function notifEcheancesDues(e){$.post("functions/watch_maturities.php").done(function(t){0==t?$("#badge-echeances").hide():(t>$("#badge-echeances").html()&&0!=e&&$.notify("De nouvelles échéances ont dépassé leur date.",{globalPosition:"bottom right",className:"info"}),$("#badge-echeances").show(),$("#badge-echeances").html(t))})}function badgeTasks(){$.post("functions/watch_tasks.php").done(function(e){0==e?$("#badge-tasks").hide():($("#badge-tasks").show(),$("#badge-tasks").html(e)),setTimeout(badgeTasks,1e4)})}function showNotification(e,t){$.notify(e,{globalPosition:"bottom right",className:t})}function checkMaturities(e){$.post("functions/check_unpaid.php",{search_id:e}).done(function(e){0!=e?($("#err_adherent").empty(),$("#unpaid").show(),$("#maturities-checked").hide()):($("#err_adherent").empty(),$("#unpaid").hide(),$("#maturities-checked").show())})}function addAdherent(){var e=$("#identite_prenom").val(),t=$("#identite_nom").val(),a=$("[name='rfid']").val(),o=$("#rue").val(),s=$("#code_postal").val(),n=$("#ville").val(),i=$("#mail").val(),l=$("#telephone").val(),r=$("#date_naissance").val();$.post("functions/add_adherent.php",{identite_prenom:e,identite_nom:t,rfid:a,rue:o,code_postal:s,ville:n,mail:i,telephone:l,date_naissance:r}).done(function(a){console.log(a);var o=JSON.parse(a);$(".has-name-completion:not(.completed)").val(e+" "+t),""!=window.miniCart&&(window.miniCart.id_beneficiaire=o.id,window.miniCart.nom_beneficiaire=e+" "+t),showNotification(o.success,"success"),$(":regex(id,^unknown-user)").hide("500")})}function checkHoliday(){var e=$("#date_debut").val();$.post("functions/check_holiday.php",{date_debut:e}).done(function(e){console.log(e),"0"!=e?($("#holiday-alert").empty(),$("#holiday-alert").append("Ce jour est chômé. Impossible d'ajouter une réservation à cette date."),$(".confirm-add").prop("disabled",!0)):($("#holiday-alert").empty(),$(".confirm-add").prop("disabled",!1),checkCalendar(!0,!1))})}function notifPanier(){if(null!=sessionStorage.getItem("panier")){var e=JSON.parse(sessionStorage.getItem("panier"));0==e.length?($("#badge-panier").hide(),$(".table-panier").empty()):($("#badge-panier").show(),$("#badge-panier").html(e.length),fillShoppingCart())}}function fillShoppingCart(){if($(".table-panier").empty(),null!=sessionStorage.getItem("panier")){var e=JSON.parse(sessionStorage.getItem("panier")),t=JSON.parse(sessionStorage.getItem("panier-noms")),a="";if(0!=e.length){for(var o=0;o<t.length;o++)a+="<tr>",a+="<td class='col-lg-11'>"+t[o]+"</td>",a+="<td class='col-lg-1'><span class='glyphicon glyphicon-trash glyphicon-button glyphicon-button-alt' onclick='removeCartElement("+o+")'></span></td>",a+="<tr>";$(".table-panier").append(a),composeURL(e[0])}}}function removeCartElement(e){var t=JSON.parse(sessionStorage.getItem("panier")),a=JSON.parse(sessionStorage.getItem("panier-noms"));t.splice(e,1),a.splice(e,1),sessionStorage.setItem("panier",JSON.stringify(t)),sessionStorage.setItem("panier-noms",JSON.stringify(a)),notifPanier()}function composeURL(e){var t="personnalisation.php?element=";t+=e,t+="&order=0",$("[name='next']").attr("href",t),$("[name='previous']").attr("href",t)}function addEntry(e,t){return $.post("functions/add_entry.php",{table:e,values:t})}function updateColumn(e,t,a,o){return $.post("functions/update_column.php",{table:e,column:t,value:a,target_id:o})}function updateEntry(e,t,a){return $.post("functions/update_entry.php",{table:e,target_id:a,values:t})}function deleteEntry(e,t){return $.post("functions/delete_entry.php",{table:e,entry_id:t})}function deleteTasksByTarget(e,t){return $.post("functions/delete_tasks_by_target.php",{token:e,target_id:t})}function logAction(e,t,a){return $.post("functions/log_action.php",{table:e,action:t,target_id:a})}function postNotification(e,t,a){return $.post("functions/post_notifications.php",{token:e,target:t,recipient:a})}function fetchColors(){return $.get("functions/fetch_colors.php")}function fetchLogs(e,t,a){$(e).trigger("loading"),$.get("functions/fetch_logs.php",{target:t,last_id:a}).done(function(o){a=renderLogs(e,o,a),console.log(a),setTimeout(fetchLogs,1e4,e,t,a)})}function renderLogs(e,t,a){$(e).trigger("loaded");var o=JSON.parse(t);console.log(a);for(var s=0;s<o.length;s++){var n="",i="",l="",r="",c="";switch(o[s].action){case"Ajout":i=" a ajouté",l="plus";break;case"Archivage":i=" a archivé";break;case"Connexion":i=" s'est connecté(e)",l="log-off";break;case"Déconnexion":i=" s'est déconnecté(e)",l="log-off";break;case"Désarchivage":i=" a désarchivé";break;case"Fermeture":i=" a fermé";break;case"Invalidation":i=" a invalidé";break;case"Modification":i=" a modifié",l="pencil";break;case"Prolongation":i=" a prolongé";break;case"Suppression":i=" a supprimé",l="trash";break;case"Transaction":i=" a conclu",l="refresh";break;case"Validation":i=" a validé"}switch(o[s].target_type){case"locations":r=" la région ",c="pushpin";break;case"participations":r=" la participation";break;case"product_categories":r=" la catégorie de produits ",c="list";break;case"produits":r=" le produit ",c="credit-card";break;case"produits_echeances":r=" l'échéance ",c="refresh";break;case"rooms":r=" la salle ",c="pushpin";break;case"sessions":r=" le cours ",c="eye-open";break;case"session_groups":r=" le groupe de récurrence ",c="eye-open";break;case"tags_session":r=" l'étiquette cours ",c="tags";break;case"tags_user":r=" l'étiquette utilisateur ",c="tags";break;case"tasks":r=" la tâche ",c="list-alt";break;case"task_comments":r=" un commentaire sur la tâche ",c="bubble";break;case"transactions":r=" la transaction ";break;case"users":r=" le profil de ",c="user"}n+="<div class='log-row' id='row-"+o[s].id+"' data-entry='"+o[s].id+"'>",n+="<span class='col-xs-1 centered'>",n+="<img class='log-picture' src='"+o[s].user_photo+"'>",n+="</span>",n+="<span>",n+="<strong>"+o[s].user_name+"</strong>",n+=i,"Connexion"!=o[s].action&&"Déconnexion"!=o[s].action&&(n+=r,n+=o[s].url?"<a href='"+o[s].url+"'>"+o[s].target_name+"</a>":o[s].target_name),n+="</span>",n+="<span class='timestamp'>"+moment(o[s].timestamp).fromNow()+"</span>",n+="</div>",a=o[s].id,$(e).prepend(n)}return a}function getUrlParameter(e){var o,s,t=decodeURIComponent(window.location.search.substring(1)),a=t.split("&");for(s=0;s<a.length;s++)if(o=a[s].split("="),o[0]===e)return void 0===o[1]?!0:o[1]}function provideAutoComplete(e,t){$.get("functions/fetch_user_list.php",{filter:t}).done(function(t){for(var a=JSON.parse(t),o=[],s=0;s<a.length;s++)o.push(a[s].user);$(e).textcomplete("destroy"),$(e).textcomplete([{match:/(^|\b)(\w{2,})$/,search:function(e,t){t($.map(o,function(t){return 0===t.toLowerCase().indexOf(e.toLocaleLowerCase())?t:null}))},replace:function(e){return e}}])})}$(document).ready(function(){jQuery.expr[":"].regex=function(e,t,a){var o=a[3].split(","),s=/^(data|css):/,n={method:o[0].match(s)?o[0].split(":")[0]:"attr",property:o.shift().replace(s,"")},i="ig",l=new RegExp(o.join("").replace(/^s+|s+$/g,""),i);return l.test(jQuery(e)[n.method](n.property))},$('[data-toggle="tooltip"]').tooltip(),"/Salsabor/my/profile"!==top.location.pathname&&"/Salsabor/notifications/settings"!==top.location.pathname&&($.cssHooks.backgroundColor={get:function(e){function a(e){return("0"+parseInt(e).toString(16)).slice(-2)}if(e.currentStyle)var t=e.currentStyle.backgroundColor;else if(window.getComputedStyle)var t=document.defaultView.getComputedStyle(e,null).getPropertyValue("background-color");return-1==t.search("rgb")?t:(t=t.match(/^rgb\((\d+),\s*(\d+),\s*(\d+)\)$/),"#"+a(t[1])+a(t[2])+a(t[3]))}});var e=0;window.numberProduits=1,notifCoursParticipants(e),notifEcheancesDues(e),notifPanier(),setInterval(notifCoursParticipants,3e4),setInterval(notifEcheancesDues,3e4),badgeNotifications(),badgeTasks(),moment.locale("fra");var t=[];$(".mandatory").each(function(){$(this).prev("label").append(" <span class='span-mandatory' title='Ce champ est obligatoire'>*</span>");var e=$(this).attr("name");t.push(e),$(this).parent().addClass("has-feedback"),$(this).parent().append("<span class='glyphicon form-control-feedback'></span>"),(""!=$(this).html()||""!=$(this).val())&&($(this).parent().addClass("has-success"),$(this).next("span").addClass("glyphicon-ok"))}).on("focus keyup change blur",function(){""!=$(this).html()||""!=$(this).val()?($(this).parent().removeClass("has-error"),$(this).parent().addClass("has-success"),$(this).next("span").removeClass("glyphicon-remove"),$(this).next("span").addClass("glyphicon-ok")):($(this).parent().removeClass("has-success"),$(this).parent().addClass("has-error"),$(this).next("span").removeClass("glyphicon-ok"),$(this).next("span").addClass("glyphicon-remove"));for(var e=0,a=0;a<t.length;a++)""!=$("[name="+t[a]+"]").val()||""!=$("[name="+t[a]+"]").html()?(e++,$(this).next().children("p").empty()):$(this).next().children("p").html("Ce champ est requis");e==t.length?($("#submit-button").prop("disabled",!1),$(".submit-button").prop("disabled",!1)):($("#submit-button").prop("disabled",!0),$(".submit-button").prop("disabled",!1))});var a=$("#filter-enabled tr");$("#search").keyup(function(){var e=$.trim($(this).val()).replace(/ +/g," ").toLowerCase();a.show().filter(function(){var t=$(this).text().replace(/\s+/g," ").toLowerCase();return!~t.indexOf(e)}).hide()}),$(".has-check").on("blur keyup focus",function(){var e=$(this),t=$(this).val(),a=$(this).attr("name").substr(12);$.post("functions/check_adherent.php",{identite:t}).done(function(o){if(console.log(o),0==o){if(0==$(":regex(id,^unknown-user)").length){var s="<div id='unknown-user"+a+"'>";s+="<p>Aucun résultat. Voulez vous inscrire cet adhérent ?</p>",s+="<a href='#user-details"+a+"' role='button' class='btn btn-info btn-block' value='create-user' id='create-user"+a+"' data-toggle='collapse' aria-expanded='false' aria-controls='userDetails'>Ouvrir le formulaire de création</a>",s+="<div id='user-details"+a+"' class='collapse'>",s+="<div class='well'>",s+="<div class='row'>",s+="<div class='col-lg-6'>",s+="<div class='form-group'>",s+="<label class='control-label'>Prénom</label><input type='text' name='identite_prenom' id='identite_prenom' class='form-control input-lg' placeholder='Prénom'>",s+="</div>",s+="</div>",s+="<div class='col-lg-6'>",s+="<div class='form-group'>",s+="<label class='control-label'>Nom</label><input type='text' name='identite_nom' id='identite_nom' class='form-control input-lg' placeholder='Nom'>",s+="</div>",s+="</div>",s+="</div>",s+="<div class='row'>",s+="<div class='col-lg-6'>",s+="<div class='form-group'>",s+="<label class='control-label'>Adresse postale</label><input type='text' name='rue' id='rue' placeholder='Adresse' class='form-control input-lg'>",s+="</div>",s+="</div>",s+="<div class='col-lg-3'>",s+="<div class='form-group'>",s+="<label class='control-label'>Code postal</label><input type='number' name='code_postal' id='code_postal' placeholder='Code Postal' class='form-control input-lg'>",s+="</div>",s+="</div>",s+="<div class='col-lg-3'>",s+="<div class='form-group'>",s+="<label class='control-label'>Ville</label><input type='text' name='ville' id='ville' placeholder='Ville' class='form-control input-lg'>",s+="</div>",s+="</div>",s+="</div>",s+="<div class='row'>",s+="<div class='col-lg-6'>",s+="<div class='form-group'>",s+="<label for='text' class='control-label'>Adresse mail</label><input type='email' name='mail' id='mail' placeholder='Adresse mail' class='form-control input-lg'>",s+="</div>",s+="</div>",s+="<div class='col-lg-6'>",s+="<div class='form-group'>",s+="<label for='telephone' class='control-label'>Numéro de téléphone</label><input type='tel' name='telephone' id='telephone' placeholder='Numéro de téléphone' class='form-control input-lg'>",s+="</div>",s+="</div>",s+="</div>",s+="<a class='btn btn-primary btn-block' onClick='addAdherent()'>Inscrire l'adhérent</a>",s+="</div>",s+="</div>",s+="</div>",e.after(s)}}else $(":regex(id,^unknown-user)").remove(),$(".has-name-completion:not(.completed)").val(t)})}),$(".separate-scroll").on("DOMMouseScroll mousewheel",function(e){var t=$(this),a=this.scrollTop,o=this.scrollHeight,s=t.height(),n="DOMMouseScroll"==e.type?-40*e.originalEvent.detail:e.originalEvent.wheelDelta,i=n>0,l=function(){return e.stopPropagation(),e.preventDefault(),e.returnValue=!1,!1};return!i&&-n>o-s-a?(t.scrollTop(o),l()):i&&n>a?(t.scrollTop(0),l()):void 0})}).delegate('*[data-toggle="lightbox"]',"click",function(e){return e.preventDefault(),$(this).ekkoLightbox({onNavigate:!1})}).on("click",".submit-relay",function(){$(".submit-relay-target").click()}).on("focus",".name-input",function(){var e=$(this).data("filter");console.log(e),provideAutoComplete($(this),e)}).on("click",".sub-modal-close",function(){$(".sub-modal").toggle()}).on("click",".trigger-sub",function(e){e.stopPropagation(),$(".sub-modal").hide(0),$(".sub-modal-body").empty();var t=document.getElementById($(this).attr("id")),a=$(this).position(),o=t.dataset.subtype,s=$(this).offset();console.log(document.getElementById($(this).attr("id")));var n,i="",l="";switch(o){case"AREP":var r=t.dataset.argument;if(n="Prolonger",i+="<input type='text' class='form-control datepicker'/>",l+="<button class='btn btn-success extend-product' data-argument='"+r+"' id='btn-sm-extend'>Prolonger</button>",moment(t.dataset.arep).isValid()){l+="<button class='btn btn-danger float-right btn-arep' data-argument='"+r+"' id='btn-sm-unextend'>Annuler AREP</button>";var c={format:"DD/MM/YYYY",inline:!0,locale:"fr",defaultDate:moment(t.dataset.arep)}}else var c={format:"DD/MM/YYYY",inline:!0,locale:"fr"};$(".sub-modal").css({top:a.top+136+"px",left:s.left+"px"}),$(".sub-modal-body").html(i);break;case"activate":var r=t.dataset.argument;n="Activer",i+="<input type='text' class='form-control datepicker'/>",l+="<button class='btn btn-success activate-product' data-argument='"+r+"' id='btn-sm-activate'>Activer</button>",$(".sub-modal").css({top:a.top+51+"px"}),$(".sub-modal-body").html(i);var c={format:"DD/MM/YYYY",inline:!0,locale:"fr"};break;case"deadline":var d=t.dataset.task;n="Date limite",i+="<input type='text' class='form-control datepicker'/>",l+="<button class='btn btn-success task-deadline' data-task='"+d+"' id='btn-set-deadline'>Définir</button>",$(".sub-modal").css({top:s.top+25+"px",left:s.left+15+"px"}),$(".sub-modal-body").html(i);var c={format:"DD/MM/YYYY HH:mm",inline:!0,locale:"fr",stepping:15};break;case"set-participation-product":n="Changer le produit à utiliser";var p=t.dataset.participation,u={};u.participation_id=p,$.when(fetchProducts($.param(u))).done(function(e){var t=displayEligibleProducts(e);$(".sub-modal-body").html(t)}),l+="<button class='btn btn-success set-participation-product' id='btn-set-participation-product' data-participation='"+p+"'>Reporter</button>",l+=" <button class='btn btn-default btn-modal set-participation-product' id='btn-product-null-record' data-participation='"+p+"'><span class='glyphicon glyphicon-link'></span> Retirer</button>",$(".sub-modal").css({top:s.top+"px"}),s.left>1e3?$(".sub-modal").css({left:s.left-350+"px"}):$(".sub-modal").css({left:s.left+20+"px"});break;case"change-participation":n="Changer le cours associé";var p=t.dataset.argument;$.when(fetchEligibleSessions(p)).done(function(e){console.log(e);var t=displayTargetSessions(e);$(".sub-modal-body").html(t)}),l+="<button class='btn btn-success report-participation' id='btn-session-changer-record' data-participation='"+p+"'>Changer</button>",$(".sub-modal").css({top:s.top+"px"}),s.left>1e3?$(".sub-modal").css({left:s.left-350+"px"}):$(".sub-modal").css({left:s.left+20+"px"});break;case"delete":n="Supprimer une participation";var p=t.dataset.argument;i+="Êtes-vous sûr de vouloir supprimer cette participation ?",$(".sub-modal-body").html(i),l+="<button class='btn btn-danger delete-participation col-lg-6' id='btn-product-delete' data-session='"+p+"'><span class='glyphicon glyphicon-trash'></span> Supprimer</button><button class='btn btn-default col-lg-6'>Annuler</button>",s.left>1e3?$(".sub-modal").css({left:s.left-350+"px"}):$(".sub-modal").css({left:s.left+20+"px"});break;case"delete-product":n="Supprimer un produit";var r=t.dataset.product;i+="ATTENTION : Si ce produit est seul dans une transaction, la transaction sera supprimée avec ce produit. Une fois validée, cette opération destructrice est irréversible. Êtes-vous sûr de vouloir supprimer ce produit ?",l+="<button class='btn btn-danger delete-product col-lg-6' id='btn-product-delete' data-product='"+r+"' data-dismiss='modal'><span class='glyphicon glyphicon-trash'></span> Supprimer</button><button class='btn btn-default col-lg-6'>Annuler</button>",$(".sub-modal").css({top:a.top+51+"px"}),$(".sub-modal-body").html(i);break;case"unlink":n="Délier une participation";var p=t.dataset.argument;i+="Êtes vous sûr de vouloir délier cette participation ? Vous la retrouverez dans les passages non régularisés",$(".sub-modal-body").html(i),l+="<button class='btn btn-default unlink-session col-lg-6' id='btn-product-unlink' data-session='"+p+"'><span class='glyphicon glyphicon-link'></span> Délier</button> <button class='btn btn-default col-lg-6'>Annuler</button>",s.left>1e3?$(".sub-modal").css({left:s.left-350+"px"}):$(".sub-modal").css({left:s.left+20+"px"});break;case"receive-maturity":var m=t.dataset.maturity,h=$("#maturity-"+m+"-method>span").first().text();if(n="Réception de l'échéance",i+="<input type='text' class='form-control datepicker reception-date'/>",i+="<label class='control-label'>Méthode de paiement</label>",i+="<input type='text' class='form-control reception-method' value='"+h+"'></input>",l+="<button class='btn btn-success receive-maturity' data-maturity='"+m+"' id='btn-sm-receive'>Enregistrer</button>",l+="<button class='btn btn-danger cancel-reception float-right' data-maturity='"+m+"' id='btn-sm-cancel-receive'>Annuler réception</button>",""!=$("#reception-span-"+m).text())var f=moment($("#reception-span-"+m).text(),"DD/MM/YYYY");else var f=null;$(".sub-modal").css({top:s.top+"px"}),$(".sub-modal").css({left:s.left-200+"px"}),$(".sub-modal-body").html(i);var c={format:"DD/MM/YYYY",defaultDate:f,inline:!0,locale:"fr"};break;case"bank-maturity":var m=t.dataset.maturity;if(n="Encaissement de l'échéance",i+="<input type='text' class='form-control datepicker bank-date'/>",l+="<button class='btn btn-success bank-maturity' data-maturity='"+m+"' id='btn-sm-receive'>Recevoir</button>",l+="<button class='btn btn-danger cancel-bank float-right' data-maturity='"+m+"' id='btn-sm-cancel-bank'>Annuler encaissement</button>",""!=$("#bank-span-"+m).text())var f=moment($("#bank-span-"+m).text(),"DD/MM/YYYY");else var f=null;$(".sub-modal").css({top:a.top+51+"px"}),$(".sub-modal-body").html(i);var c={format:"DD/MM/YYYY",defaultDate:f,inline:!0,locale:"fr"};break;case"deadline-maturity":var m=t.dataset.maturity;if(n="Modifier la date limite",i+="<input type='text' class='form-control datepicker deadline-date'/>",l+="<button class='btn btn-success deadline-maturity' data-maturity='"+m+"' id='btn-sm-deadline'>Enregistrer</button>",$(".sub-modal").css({top:a.top+51+"px"}),$(".sub-modal-body").html(i),""!=$("#deadline-maturity-span-"+m).text())var f=moment($("#deadline-maturity-span-"+m).text(),"DD/MM/YYYY");else var f=null;var c={format:"DD/MM/YYYY",defaultDate:f,inline:!0,locale:"fr"};break;case"user-tags":case"session-tags":var b=document.getElementById($(this).attr("id")).dataset.targettype,g=/^([a-z]+)/i.exec(o);window.target=$(this).attr("id"),n="Ajouter une étiquette",$(".sub-modal").removeClass("col-lg-7"),$(".sub-modal").addClass("col-lg-3"),"/Salsabor/dashboard"===top.location.pathname?$(".sub-modal").css({top:s.top+25+"px",left:s.left-25+"px"}):$(".sub-modal").css({top:s.top+25+"px",left:s.left+25+"px"}),$.when(fetchTags(g[0])).done(function(e){var t=displayTargetTags(e,b,g[0]);$(".sub-modal-body").html(t)});break;case"edit-tag":var t=document.getElementById($(this).attr("id")).dataset.target,g=document.getElementById($(this).attr("id")).dataset.tagtype,v=$("#tag-"+t).text();n="Modifier une étiquette",$(".sub-modal").removeClass("col-lg-7"),$(".sub-modal").addClass("col-lg-3"),$(".sub-modal").css({top:s.top+"px",left:s.left+45+"px"}),i+="<div class='input-group'>",i+="<input type='text' class='form-control' id='edit-tag-name' data-target='"+t+"' data-tagtype='"+g+"' placeholder='Nom de l&apos;étiquette' value='"+v+"'>",i+="<span class='input-group-btn'><button class='btn btn-success btn-tag-name' type='button'>Valider</button></span>",i+="</div>",$.when(fetchColors()).done(function(e){i+="<div class='container-fluid' id='colors'>";for(var a=JSON.parse(e),o=0;o<a.length;o++)i+="<div class='color-cube col-xs-3 col-md-3 col-lg-2' id='color-"+a[o].color_id+"' style='background-color:"+a[o].color_value+"' data-target='"+t+"'  data-tagtype='"+g+"'>","#"+a[o].color_value==$("#tag-"+t).css("backgroundColor")&&(i+="<span class='glyphicon glyphicon-ok color-selected'></span>"),i+="</div>";if(i+="</div>","session"==g){var s;s=$("#tag-"+t).find(".glyphicon-star").length>0?1:0,i+="<input name='is_mandatory' class='mandatory-tag-check' id='is_mandatory-"+t+"' data-target='"+t+"' value='"+s+"'> Obligatoire <span class='glyphicon glyphicon-question-sign' id='mandatory-tooltip' data-toggle='tooltip' title='Restreint la compatibilité produit/cours aux étiquettes obligatoires sélectionnées. Si un produit doit être compatible avec une couleur entière, n&apos;ajoutez pas d&apos;étiquette.'></span>"}$(".sub-modal-body").html(i),$("#is_mandatory-"+t).checkboxX({threeState:!1,size:"lg"}),$("#mandatory-tooltip").tooltip()});break;case"room-color":var t=document.getElementById($(this).attr("id")).dataset.target;n="Modifier la colueur de la salle",$(".sub-modal").removeClass("col-lg-7"),$(".sub-modal").addClass("col-lg-3"),$(".sub-modal").css({top:s.top+"px",left:s.left+45+"px"}),$.when(fetchColors()).done(function(e){i+="<div class='row' id='colors'>";for(var a=JSON.parse(e),o=0;o<a.length;o++)i+="<div class='color-cube col-xs-4 col-md-3 col-lg-2' id='color-"+a[o].color_id+"' style='background-color:"+a[o].color_value+"' data-target='"+t+"' data-color='"+a[o].color_id+"'>","#"+a[o].color_value==$("#room-color-cube-"+t).css("backgroundColor")&&(i+="<span class='glyphicon glyphicon-ok color-selected'></span>"),i+="</div>";i+="</div>",$(".sub-modal-body").html(i)});break;default:n="Sub modal"}$(".sub-modal-title").text(n),$(".sub-modal-footer").html(l),$(".datepicker").datetimepicker(c);var y=/historique/i;if(null!=y.exec(top.location.pathname)&&(console.log("Historique"),$(".sub-modal").css({left:"74%"})),$(".modal").length>0)var k="col-xs-5 col-md-4 col-lg-3";else var k="col-xs-5 col-md-6 col-lg-3";$(".sub-modal").addClass(k),$(".sub-modal").show(0)}).on("change",".mandatory-tag-check",function(){var e=document.getElementById($(this).attr("id")).dataset.target,t=$(this).val();console.log("checkbox of tag "+e+" changed to "+t),$.when(updateColumn("tags_session","is_mandatory",t,e)).done(function(){1==t?$("#tag-"+e).prepend("<span class='glyphicon glyphicon-star'></span> "):$("#tag-"+e).remove($(".glyphicon-star")),logAction("tags_session","Modification",e)})}).on("click",".sub-menu-toggle",function(){console.log("toggling"),$(".small-sidebar-container").toggle()}).on("show.bs.modal","#edit-modal",function(e){e.stopPropagation();var t=$(e.relatedTarget).data("entry"),a=$(e.relatedTarget).data("transaction"),o=$(e.relatedTarget).data("table"),s=$(this);s.find(".modal-title").text($(e.relatedTarget).attr("title"));var n="<form class='form-horizontal' id='modal-form'>";$(".modal-editable-"+t).each(function(){var e=$(this),t=$(this).data("field"),a=$(this).data("name"),o=$(this).data("input"),s=$(this).data("placeholder");n+="<div class='form-group'>",n+="<label for='"+t+"' class='col-lg-4 control-label'>"+a+"</label>",n+="<div class='col-lg-8'>","rate_ratio"==t?(n+='<select name="'+t+'" class="form-control">',n+="heure"==e.text()?'<option selected="selected" value="heure">heure</option>':'<option value="heure">heure</option>',n+="personne"==e.text()?'<option selected="selected" value="personne">personne</option>':'<option value="personne">personne</option>',n+="prestation"==e.text()?'<option selected="selected" value="prestation">prestation</option>':'<option value="prestation">prestation</option>',n+="</select>"):void 0===o?(n+='<input type="text" class="form-control',void 0!==$(this).data("complete")?(console.log($(this).data("complete-filter")),n+=' name-input" data-filter="'+$(this).data("complete-filter")+'"'):n+='"',n+=' name="'+t+'"',n+=s?'placeholder="'+e.text()+'">':' value="'+e.text()+'">'):"textarea"==o&&(n+="<textarea class='form-control' name='"+t+"'>"+e.text()+"</textarea>"),n+="</div>",n+="</div>"}),n+="</form>",s.find(".edit-form-space").html(n),s.find(".send-edit-data").on("click",function(){var e=s.find("#modal-form").serialize();console.log(t);var n=/\D*/.exec(t);if(null===n||""==n||"transactions"==o){console.log("no chars");var i=t}else{console.log("chars");var i=t.replace(/(\D*)/i,"")}console.log("obtained entry: "+i),$.when(updateEntry(o,e,i)).done(function(e){var n=s.find("#modal-form").serializeArray(),i=0;$(".modal-editable-"+t).each(function(){""!=n[i].value?($(this).text(n[i].value),$(this).data("placeholder",!1)):($(this).text("-"),$(this).data("placeholder",!0)),i++}),"produits_echeances"==o&&showAmountDiscrepancy(a),s.modal("hide"),showNotification("Modifications enregistrées","success")})})}).on("hide.bs.modal","#edit-modal",function(e){console.log("unbinding edit button"),$(this).find(".send-edit-data").off("click")}).on("show.bs.modal","#delete-modal",function(e){var t=$(e.relatedTarget).data("entry"),a=$(e.relatedTarget).data("table"),o=$(e.relatedTarget).data("delete"),s=$(this);if("produits_echeances"==a)var n=$(e.relatedTarget).data("transaction");s.find(".modal-title").text($(e.relatedTarget).attr("title")),s.find(".modal-body").text("Êtes-vous sûr de vouloir supprimer cette entrée ?"),s.find(".delete-target").on("click",function(){console.log(t),$.when(deleteEntry(a,t)).done(function(e){console.log(e),$(o).remove(),n&&showAmountDiscrepancy(n),s.modal("hide"),showNotification("Suppression effectuée","success")})})}).on("hide.bs.modal","#delete-modal",function(e){$(this).find(".delete-target").off("click")}).on("show.bs.modal","#archive-modal",function(e){var t=$(e.relatedTarget).data("entry"),a=$(e.relatedTarget).data("table"),o=$(this),s=$(e.relatedTarget);o.find(".archive-data").on("click",function(){$.when(updateColumn(a,"archived",1,t)).done(function(e){$(".user-legend").append("<span class='archived-state'>(Archivé)</span>"),s.replaceWith("<span class='col-xs-1 glyphicon glyphicon-folder-open glyphicon-button glyphicon-button-alt glyphicon-button-big dearchive-data' title='Désarchiver' data-entry='"+t+"' data-table='users'></span>"),o.modal("hide"),logAction(a,"Archivage",t),showNotification("Utilisateur archivé","Success")})})}).on("hide.bs.modal","#archive-modal",function(e){$(this).find(".archive-data").off("click")}).on("click",".dearchive-data",function(){var e=$(this).data("entry"),t=$(this).data("table");$.when(updateColumn(t,"archived",0,e)).done(function(a){$(".archived-state").empty(),$(".dearchive-data").replaceWith("<span class='col-xs-1 glyphicon glyphicon-folder-close glyphicon-button glyphicon-button-alt glyphicon-button-big' title='Archiver' data-toggle='modal' data-target='#archive-modal' data-entry='"+e+"' data-table='users'></span>"),logAction(t,"Désarchivage",e),showNotification("Utilisateur désarchivé","Success")})}).on("click",".selectable",function(){var t=($(this),/([a-z]*-selectable)/gi.exec($(this).attr("class"))[0]);$("."+t).removeClass("selected"),$(this).addClass("selected")}).on("loading",".loading-container",function(){$(this).is(":empty")&&($(this).append("<img src='assets/img/loading.gif' class='loading-indicator'>"),console.log("Inserting loading gif in"+$(this)))}).on("loaded",".loading-container",function(){$(this).find(".loading-indicator").remove()}).on("keyup keypress",".no-submit",function(e){var t=e.keyCode||e.which;return 13===t?(e.preventDefault(),$(document.activeElement).blur(),!1):void 0}),$(".has-name-completion").on("click blur keyup",function(){""!=$(this).val()?$(this).addClass("completed"):$(this).removeClass("completed")}),$("*[date-today='true']").click(function(){var e=(new moment).format("YYYY-MM-DD");$(this).parent().prev().val(e),$(this).parent().prev().blur()});